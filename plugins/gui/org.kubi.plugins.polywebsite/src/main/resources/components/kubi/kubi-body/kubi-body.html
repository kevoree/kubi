<link rel="import" href="../../bower_components/polymer/polymer.html"/>

<link rel="stylesheet" type="text/css" href="kubi-body.css"/>

<!-- Kubi components -->
<link rel="import" href="../kubi-data/kubi-data.html"/>
<link rel="import" href="../kubi-chart-epoch/kubi-chart-epoch.html"/>
<link rel="import" href="../kubi-slider/kubi-slider.html"/>
<link rel="import" href="../kubi-scalepicker/kubi-scalepicker.html"/>
<link rel="import" href="../kubi-sidedevicepicker/kubi-sidedevicepicker.html"/>
<link rel="import" href="../kubi-switch-periodwanted/kubi-switch-periodwanted.html"/>
<link rel="import" href="../kubi-datepicker/kubi-datepicker.html"/>
<link rel="import" href="../kubi-period-view/kubi-period-view.html"/>
<link rel="import" href="../kubi-period-evolution/kubi-period-evolution.html"/>
<link rel="import" href="../kubi-c3js/kubi-c3js.html"/>
<link rel="import" href="../kubi-metrics-graphics/kubi-metrics-graphics.html"/>

<link rel="import" href="../kubi-stateMachine-basic-view/kubi-stateMachine-basic-view.html"/>


<dom-module id="kubi-body">
    <template>
        <div id="kubibody">
            <div id="settings">
                <!--kubi-data-test id="dataTest" ></kubi-data-test-->


                <kubi-sidedevicepicker id="devicepicker" on-devicepicker-updated="devicepickerUpadated"></kubi-sidedevicepicker>
                <kubi-scalepicker id="scalepicker" on-scalepicker-updated="scalepickerUpdated"></kubi-scalepicker>
                <kubi-slider id="slider" value={{slider_time}} on-slider-updated="sliderUpdated"></kubi-slider>
                <kubi-switch-periodwanted id="switchPeriod" on-switch-periodwanted-updated="switchPeriodUpdated"></kubi-switch-periodwanted>
                <kubi-datepicker id="datepicked" on-date-updated="dateUpdated"></kubi-datepicker>
            </div>

            <kubi-data id="graphic" time="[[slider_time]]" scale="[[graph_scale]]" devices="[[graph_devices]]" wantperiod="[[graph_wantperiod]]"></kubi-data>

            <kubi-period-evolution id="periodEvolution" time="[[slider_time]]" scale="[[graph_scale]]" devices="[[graph_devices]]"></kubi-period-evolution>

            <kubi-metrics-graphics id="metricsGraphics" time="[[slider_time]]" scale="[[graph_scale]]" devices="[[graph_devices]]" wantperiod="[[graph_wantperiod]]"></kubi-metrics-graphics>

            <!--<kubi-chart-epoch id="epochChart" time="[[slider_time]]" scale="[[graph_scale]]" devices="[[graph_devices]]" wantperiod="[[graph_wantperiod]]"></kubi-chart-epoch>-->

            <!--<kubi-c3js></kubi-c3js>-->

            <kubi-stateMachine-basic-view id="fsmBasic"></kubi-stateMachine-basic-view>
            <!--kubi-period-view id="periodView"></kubi-period-view-->
        </div>
    </template>
</dom-module>

<script>
    Polymer({
        is: "kubi-body",
        properties: {
            slider_time: {
                type: Number,
                value: 0
            },
            graph_scale: {
                type: Number,
                value: 86400000
            },
            graph_devices: {
                type: Array,
                value: ["plug"]
            },
            graph_wantperiod: {
                type: Boolean,
                value: false
            }
        },
        sliderUpdated: function (event, detail) {
            this.slider_time = detail.value;
        },
        scalepickerUpdated: function (event, detail) {
            this.graph_scale = detail.value;
        },
        devicepickerUpadated: function (event, detail) {
            this.graph_devices = detail.value;
        },
        switchPeriodUpdated: function (event, detail) {
            this.graph_wantperiod = detail.value;
        },
        dateUpdated: function (event, detail) {
            this.slider_time = detail.value/1000;
            this.$.slider.value = detail.value/1000;
            this.$.slider.fire("notifySlider", detail.value); // TODO : doesn't work :'( => need to find a way to notify the slider of the change
        },
        ready: function () {
        }
    });
</script>