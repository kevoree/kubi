<link rel="import" href="../../bower_components/polymer/polymer.html"/>

<link rel="import" href="../kubi-model/kubi-model.html"/>

<script src="/js/org.kubi.model.js"></script>
<script src="/js/org.kevoree.modeling.microframework.browser.js"></script>
<script src="/js/org.kevoree.modeling.drivers.websocket.js"></script>

<script src="./kubi-data2.js"></script>

<!-- canvasJS -->
<script src="../../../js/canvasjs.min.js"></script>

<dom-module id="kubi-data">
    <link rel="stylesheet" type="text/css" href="./kubi-data.css"/>
    <template>
        <kubi-model id="modelHandlerData" on-model-connected="modelConnected"></kubi-model>
        <div id="chartContainer"></div>
    </template>
</dom-module>

<script>
    Polymer({
        is: "kubi-data",
        properties: {
            time: {
                type: Number,
                observer: 'updateGraph'
            },
            scale: {
                type: Number,
                observer: 'updateGraph'
            },
            devices: {
                type: Array,
                value: ["plug"],
                observer: 'updateGraph'
            },
            wantperiod: {
                type: String,
                value: false,
                observer: 'updateGraph'
            }
        },
        updateGraph: function (event) {
            if (this.time != undefined && this.scale != undefined && this.devices != undefined) {
                try {
                    updateGraph(this.time, this.scale, this.devices, this.wantperiod);
                } catch (e) {
                    console.error(e);
                }

            }
        },
        ready: function (){
            try{
                if (this.$.modelHandlerData.modelAvailable())
                {
                    initWithModelCanvas(this.$.modelHandlerData.model());
                }
            }catch (err){console.error("ready",err);}
        },
        modelConnected : function(event, details){
            // TODO : clean & init
            initWithModelCanvas(details.value);
        }
    });
</script>